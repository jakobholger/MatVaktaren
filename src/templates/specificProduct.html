{% extends "layout.html" %}

{% block title %}
    {{product.product_name}}
{% endblock %}

{% block main %}

<td><a href="/products"><h4>Gå tillbaka</h4></a></td>

<u><h1>{{product.product_name}}</h1></u>

<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<div id="plotly-graph" style="height: fit-content; width: 80%; margin: 0 auto;"></div>
<script>
    // Parse the Plotly JSON and display the graph
    var graphJson = {{ graph_json|safe }};
    Plotly.newPlot('plotly-graph', graphJson.data, graphJson.layout);
</script>

<hr>

<u><h3>Nuvarande pris: {{product_metrics.current_price}} kr</h3></u>


<hr>

<u><h3>Prisstatistik för produkten / WORK IN PROGRESS</h3></u>
<table style="height: 1%;">
    <thead>
        <tr>
            <th>Högsta pris (kr)</th>
            <th>Lägsta pris (kr)</th>
            <th>Genomsnittligt pris (kr)</th>
            <th>Prisförändring senaste 7 Dagarna (kr)</th>
            <th>Prisförändring senaste 7 Dagarna (%)</th>
            <th>Prisförändring senaste 14 Dagarna (kr)</th>
            <th>Prisförändring senaste 14 Dagarna (%)</th>
            <th>Prisförändring senaste 30 Dagarna (kr)</th>
            <th>Prisförändring senaste 30 Dagarna (%)</th>
            <!--
            <th>Price change last 6 Months (kr)</th>
            <th>Price change last 6 Months (%)</th>
            <th>Price change last Year (kr)</th>
            <th>Price change last Year (%)</th>
            -->
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>{{product_metrics.all_time_high}}</td>
            <td>{{product_metrics.all_time_low}}</td>
            <td>{{product_metrics.average_price}}</td>
            <td style="color: {{ 'green' if product_metrics.price_change_7_days != 'N/A' and product_metrics.price_change_7_days >= 0 else 'red' }}">{{product_metrics.price_change_7_days}}</td>
            <td style="color: {{ 'green' if product_metrics.price_percentage_7_days != 'N/A' and product_metrics.price_percentage_7_days >= 0 else 'red' }}">{{product_metrics.price_percentage_7_days}}</td>
            <td style="color: {{ 'green' if product_metrics.price_change_14_days != 'N/A' and product_metrics.price_change_14_days >= 0 else 'red' }}">{{product_metrics.price_change_14_days}}</td>
            <td style="color: {{ 'green' if product_metrics.price_percentage_14_days != 'N/A' and product_metrics.price_percentage_14_days >= 0 else 'red' }}">{{product_metrics.price_percentage_14_days}}</td>
            <td style="color: {{ 'green' if product_metrics.price_change_30_days != 'N/A' and product_metrics.price_change_30_days >= 0 else 'red' }}">{{product_metrics.price_change_30_days}}</td>
            <td style="color: {{ 'green' if product_metrics.price_percentage_30_days != 'N/A' and product_metrics.price_percentage_30_days >= 0 else 'red' }}">{{product_metrics.price_percentage_30_days}}</td>
            <!--
            <td>Price change last 6 Months (kr)</td>
            <td>Price change last 6 Months (%)</td>
            <td>Price change last Year (kr)</td>
            <td>Price change last Year (%)</td>
            -->
        </tr>
    </tbody>
</table>


<div style="height: 300px; overflow-y: auto;">
<table>
    <thead>
        <tr>
            <th>Datumn</th>
            <th>Pris (kr)</th>
            <th>Jmf-pris</th>
        </tr>
    </thead>
    <tbody>
        {% for item in price_history %}
        <tr>
            <td>{{ item.date }}</td>
            <td>{{ item.price }}</td>
            <td>{{ item.unit }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
</div>

{% endblock %}